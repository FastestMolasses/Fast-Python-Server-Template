<p align="center">
  <h2 align="center">⚡️ Fast Python Server</h3>

  <div align="center">

  ![Build](https://github.com/FastestMolasses/Fast-Python-Server-Template/actions/workflows/main.yaml/badge.svg)&nbsp;[![GitHub license](https://badgen.net/github/license/FastestMolasses/Fast-Python-Server-Template)](https://github.com/FastestMolasses/Fast-Python-Server-Template/blob/main/LICENSE)

  </div>

  <p align="center">
    A fully setup Python web server focused on performance and type safety.
    <br />
    Built with FastAPI, Pydantic, Ruff, and MyPy.
    <br />
    <br />
    <a href="https://github.com/FastestMolasses/Fast-Python-Server-Template/issues">Report Bug</a>
    ·
    <a href="https://github.com/FastestMolasses/Fast-Python-Server-Template/issues">Request Feature</a>
  </p>
</p>

## Table of Contents

* [Requirements](#requirements)
* [Installation](#installation)
* [Databases](#databases)
    * [Migrations](#Migrations)
    * [Downgrade Migration](#Downgrade-Migration)
* [Contributing](#contributing)

## Requirements

* [Python 3.11+](https://www.python.org/downloads/)
* [Docker](https://www.docker.com/get-started/)

## Installation

1. Fork this repo ([How to create a private fork](https://gist.github.com/0xjac/85097472043b697ab57ba1b1c7530274))

2. Install depedenencies

    Poetry
    ```bash
    poetry install
    ```

    Pip
    ```bash
    pip install -r requirements.txt
    ```

3. Enter the environment if you haven't already

    Poetry
    ```bash
    # macOS
    source $(poetry env info --path)/bin/activate

    # windows (powershell)
    & ((poetry env info --path) + "\Scripts\activate.ps1")

    # Alternatively, you can use this command
    poetry shell
    ```

    Pip
    ```bash
    # macOS
    source env/bin/activate

    # windows (powershell)
    .\env\Scripts\activate.ps1
    ```

4. Install [Docker](https://www.docker.com/get-started/)

5. Start your Docker services

    ```bash
    docker-compose up
    ```

6. Clone `.env.example` to `.env` and update the values

    ```bash
    # macOS
    cp .env.example .env

    # windows (powershell)
    copy .env.example .env
    ```

    You can use this command to generate secret keys
    ```bash
    openssl rand -hex 128
    ```

7. Run the server

    For development. Will use (.env.dev)
    ```bash
    uvicorn main:server --reload
    ```

    For testing production .env locally. Will use (.env)
    ```
    PROD=1 uvicorn main:server --reload
    ```

## Databases

### Migrations

To do a database migration, follow the steps below.

1. Update `database/models.py` with the changes you want
2. Run this command to generate the migration file in `migrations/versions`

    ```bash
    alembic revision --autogenerate -m "Describe your migration"
    ```

3. Check the newly generated migration file and verify that it generated correctly.
4. Run this command to apply the migration
    ```bash
    alembic upgrade head
    ```

⛔️ Autogenerated migrations cannot detect these changes:

- Changes of table name
- Changes of column name
- Anonymously named constraints
- Special SQLAlchemy types such as Enum when generated on a backend which doesn’t support ENUM directly

[Reference](https://alembic.sqlalchemy.org/en/latest/autogenerate.html#what-does-autogenerate-detect-and-what-does-it-not-detect)

These changes will need to be migrated manually by creating an empty migration file and then writing the code to create the changes.

```bash
# Manual creation of empty migration file
alembic revision -m "Describe your migration"
```

### Downgrade Migration

Run this command to revert every migration back to the beginning.

```bash
alembic downgrade base
```

## Contributing

1. **Fork the Repository**: Start by forking the repository to your own GitHub account.
2. **Clone the Forked Repository**: Clone the fork to your local machine.
3. **Create a New Branch**: Always create a new branch for your changes.
4. **Make Your Changes**: Implement your changes.
5. **Run Tests**: Make sure to test your changes locally.
6. **Submit a Pull Request**: Commit and push your changes, then create a pull request against the main branch.
